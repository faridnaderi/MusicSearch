var APP=angular.module("MusicSearchApp",["ngSanitize"]);APP.controller("AppCtrl",["$scope","$timeout","$window",function(n,t,i){n.inputFocused=!1;n.$on("SearchInputFocused",function(){n.inputFocused=!0;$(".banner").css("height",angular.element(i).innerHeight()/2-70)});n.$on("ItemClicked",function(t,i){n.$broadcast("ItemClickedToModal",i)})}]);APP.controller("BannerCtrl",["$scope","$element","$window","$timeout",function(n,t,i,r){n.CalcHeight=function(){if(!n.$parent.inputFocused){var r=angular.element(i).innerHeight()-200;$(t).css("height",r)}};angular.element(i).bind("resize",function(){n.CalcHeight()});n.CalcHeight();r(function(){$(t).find(".fadeTo").fadeIn(500)},300)}]);APP.controller("SearchCtrl",["$scope","$element","$timeout","$http",function(n,t,i,r){n.searchOffset=0;n.searchLimit=20;n.viewMoreShow=!1;n.allData=[];n.oldSearchTerm="";n.searchTerm="girl";i(function(){$(t).find(".fadeIn").removeClass("vertical");i(function(){$(t).find(".search-input-container > .container > div").removeClass("small")},400)},600);n.autocompleteOpen=!1;n.ShowAutocomplete=function(){n.autocompleteOpen||(n.autocompleteOpen=!0,i(function(){$(".autocomplete").fadeIn(300).slideDown(300)},0))};n.HideAutocomplete=function(){n.autocompleteOpen&&(n.autocompleteOpen=!1,i(function(){$(".autocomplete").fadeOut(300).slideUp(300)},0))};n.InputChanging=function(){n.searchTerm.length>=3?r.get("https://api.spotify.com/v1/search?q="+n.searchTerm+"&type=album,artist&limit=10").then(function(t){n.autocompleteList=n.Shuffle(t.data.albums.items.concat(t.data.artists.items));n.autocompleteList.length>0?n.ShowAutocomplete():n.HideAutocomplete()}):n.HideAutocomplete()};n.InputFocused=function(){i(function(){$("body").addClass("overflow-auto")},800);n.$emit("SearchInputFocused")};n.InputKeyPressed=function(t){t.which===13&&(n.Search(),t.preventDefault())};n.Shuffle=function(n){for(var i,r,t=n.length;t;t--)i=Math.floor(Math.random()*t),r=n[t-1],n[t-1]=n[i],n[i]=r;return n};n.AutocompleteItemClicked=function(t){n.searchTerm=t;n.Search()};n.Search=function(){n.inputFocused||n.InputFocused();n.HideAutocomplete();n.searchTerm&&r.get("https://api.spotify.com/v1/search?q="+n.searchTerm+"&type=album,artist&offset="+n.searchOffset*n.searchLimit+"&limit="+n.searchLimit).then(function(t){n.data=t.data;(n.data.albums.next||n.data.artists.next)&&(n.viewMoreShow=!0);var i=n.data.albums.items.concat(n.data.artists.items);n.searchTerm!==n.oldSearchTerm&&(n.allData=[]);n.allData=n.allData.concat(n.Shuffle(i));n.oldSearchTerm=n.searchTerm})};n.ViewMore=function(){n.searchOffset++;n.Search()};n.ItemClicked=function(t){n.$emit("ItemClicked",t)}}]);APP.filter("SearchInText",function(){return function(n,t){var i=new RegExp(t,"ig");return n.replace(i,'<span class="search-character">'+t+"<\/span>")}});APP.filter("msToTrackTime",function(){return function(n){var i=new Date(n),t=i.getSeconds(),r;return t<10&&(t="0"+t),r=i.getMinutes(),r+":"+t}});APP.filter("itemTitle",function(){return function(n){var t=$(window).width>400?32:16;return n.length>t&&(n=n.slice(0,t)+"..."),n}});APP.directive("detailsModal",function(){return{restrict:"E",replace:!0,templateUrl:"views/details-modal.html",controller:["$scope","$element","$http","$timeout",function(n,t,i,r){n.type="";n.$on("ItemClickedToModal",function(t,r){n.item=r;var u=r.type==="artist"?"https://api.spotify.com/v1/artists/"+r.id+"/albums?offset=0&limit=50":r.href;i.get(u).then(function(t){n.data=t.data;n.ShowModal()})});n.ShowModal=function(){$(t).fadeIn(300);$("body").removeClass("overflow-auto");r(function(){$(".album-date").each(function(){$(this).html(n.RandomYear())})})};n.CloseModal=function(i){$(t).fadeOut(300,function(){n.type="";n.data={}});$("body").addClass("overflow-auto");i.stopPropagation()};n.years=[];for(var u=1980;u<=2017;u++)n.years.push(u);n.RandomYear=function(){return n.years[Math.floor(Math.random()*n.years.length)]}}]}});